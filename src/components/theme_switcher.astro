---
interface Props {
	size?: "sm" | "md" | "lg";
}

const { size = "md" } = Astro.props;

// Size-based classes
const sizeClasses = {
	sm: "p-2",
	md: "p-2",
	lg: "p-3",
};

const iconSizeClasses = {
	sm: "w-4 h-4",
	md: "w-5 h-5",
	lg: "w-6 h-6",
};

const buttonClasses = [
	"text-on-background/80 hover:text-primary transition-colors duration-200 rounded-lg",
	"hover:bg-surface-variant/30 focus:outline-none focus:ring-2 focus:ring-primary/50",
	"border border-surface-variant/50",
	sizeClasses[size],
].join(" ");
---

<button
  id="themeSwitcher"
  class={buttonClasses}
  title="Toggle theme"
>
  <!-- Light theme icon -->
  <svg 
    id="lightIcon" 
    class={`${iconSizeClasses[size]} hidden`}
    fill="none" 
    stroke="currentColor" 
    viewBox="0 0 24 24"
  >
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
  </svg>
  
  <!-- Dark theme icon -->
  <svg 
    id="darkIcon" 
    class={`${iconSizeClasses[size]} hidden`}
    fill="none" 
    stroke="currentColor" 
    viewBox="0 0 24 24"
  >
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
  </svg>
  
  <!-- System theme icon -->
  <svg 
    id="systemIcon" 
    class={iconSizeClasses[size]}
    fill="none" 
    stroke="currentColor" 
    viewBox="0 0 24 24"
  >
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
  </svg>
</button>

<script is:inline>
(function() {
  // Prevent multiple initialization
  if (window.hostupThemeSwitcherInitialized) return;
  window.hostupThemeSwitcherInitialized = true;
  
  let currentThemeIndex = 0;
  const themes = ["system", "light", "dark"];
  
  function updateDisplay() {
    const theme = themes[currentThemeIndex];
    
    // Update all theme switcher instances on the page
    const allSwitchers = document.querySelectorAll('[id="themeSwitcher"]');
    allSwitchers.forEach(switcher => {
      const lightIcon = switcher.querySelector('[id="lightIcon"]');
      const darkIcon = switcher.querySelector('[id="darkIcon"]');
      const systemIcon = switcher.querySelector('[id="systemIcon"]');
      
      // Hide all icons
      if (lightIcon) lightIcon.classList.add("hidden");
      if (darkIcon) darkIcon.classList.add("hidden");
      if (systemIcon) systemIcon.classList.add("hidden");
      
      // Show the appropriate icon
      switch (theme) {
        case "light":
          if (lightIcon) lightIcon.classList.remove("hidden");
          break;
        case "dark":
          if (darkIcon) darkIcon.classList.remove("hidden");
          break;
        case "system":
          if (systemIcon) systemIcon.classList.remove("hidden");
          break;
      }
    });
    
    // Apply theme to document
    if (theme === "system") {
      const darkModeOn = window.matchMedia("(prefers-color-scheme: dark)").matches;
      document.documentElement.setAttribute("data-theme", darkModeOn ? "dark" : "light");
    } else {
      document.documentElement.setAttribute("data-theme", theme);
    }
    
    // Save to localStorage
    localStorage.setItem("theme", theme);
  }
  
  function initTheme() {
    // Get saved theme or default to system
    const savedTheme = localStorage.getItem("theme") || "system";
    currentThemeIndex = themes.indexOf(savedTheme);
    if (currentThemeIndex === -1) currentThemeIndex = 0;
    
    updateDisplay();
    
    // Add click handlers to all theme switcher buttons
    const allSwitchers = document.querySelectorAll('[id="themeSwitcher"]');
    allSwitchers.forEach(switcher => {
      if (!switcher.hasAttribute("data-theme-handler")) {
        switcher.setAttribute("data-theme-handler", "true");
        
        switcher.addEventListener("click", function() {
          currentThemeIndex = (currentThemeIndex + 1) % themes.length;
          updateDisplay();
          
          // Animation feedback
          this.style.transform = "scale(0.9)";
          setTimeout(() => {
            this.style.transform = "scale(1)";
          }, 100);
        });
      }
    });
  }
  
  // Initialize when ready
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initTheme);
  } else {
    initTheme();
  }
  
  // Handle Astro page loads
  document.addEventListener("astro:page-load", initTheme);
})();
</script> 